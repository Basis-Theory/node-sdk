/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../mock-server/MockServerPool";
import { BasisTheoryClient } from "../../src/Client";

describe("Webhooks", () => {
    test("ping", async () => {
        const server = mockServerPool.createServer();
        const client = new BasisTheoryClient({ apiKey: "test", correlationId: "test", environment: server.baseUrl });

        server.mockEndpoint().get("/ping").respondWith().statusCode(200).build();

        const response = await client.webhooks.ping();
        expect(response).toEqual(undefined);
    });

    test("get", async () => {
        const server = mockServerPool.createServer();
        const client = new BasisTheoryClient({ apiKey: "test", correlationId: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "7a70e388-9c78-4c1b-85dd-f2b4e7a823f6",
            tenant_id: "064bbc70-204b-4ef1-a757-ec0878be5945",
            status: "enabled",
            name: "E2E delivery test - 2024-07-19T14:40:01.229Z",
            url: "https://example.basistheory.com/",
            notify_email: "notify@example.com",
            events: ["token.created"],
            created_by: "b6b44a65-c13a-4df2-bd7f-894f4fbe6b02",
            created_at: "2024-07-18T20:20:18Z",
            modified_by: "b6b44a65-c13a-4df2-bd7f-894f4fbe6b02",
            modified_at: "2024-07-19T14:40:01Z",
        };
        server.mockEndpoint().get("/webhooks/id").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.webhooks.get("id");
        expect(response).toEqual({
            id: "7a70e388-9c78-4c1b-85dd-f2b4e7a823f6",
            tenantId: "064bbc70-204b-4ef1-a757-ec0878be5945",
            status: "enabled",
            name: "E2E delivery test - 2024-07-19T14:40:01.229Z",
            url: "https://example.basistheory.com/",
            notifyEmail: "notify@example.com",
            events: ["token.created"],
            createdBy: "b6b44a65-c13a-4df2-bd7f-894f4fbe6b02",
            createdAt: new Date("2024-07-18T20:20:18.000Z"),
            modifiedBy: "b6b44a65-c13a-4df2-bd7f-894f4fbe6b02",
            modifiedAt: new Date("2024-07-19T14:40:01.000Z"),
        });
    });

    test("update", async () => {
        const server = mockServerPool.createServer();
        const client = new BasisTheoryClient({ apiKey: "test", correlationId: "test", environment: server.baseUrl });
        const rawRequestBody = { name: "webhook-update", url: "http://www.example.com", events: ["token:created"] };
        const rawResponseBody = {
            id: "7a70e388-9c78-4c1b-85dd-f2b4e7a823f6",
            tenant_id: "064bbc70-204b-4ef1-a757-ec0878be5945",
            status: "enabled",
            name: "E2E delivery test - 2024-07-19T14:40:01.229Z",
            url: "https://example.basistheory.com/",
            notify_email: "notify@example.com",
            events: ["token.created"],
            created_by: "b6b44a65-c13a-4df2-bd7f-894f4fbe6b02",
            created_at: "2024-07-18T20:20:18Z",
            modified_by: "b6b44a65-c13a-4df2-bd7f-894f4fbe6b02",
            modified_at: "2024-07-19T14:40:01Z",
        };
        server
            .mockEndpoint()
            .put("/webhooks/id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.webhooks.update("id", {
            name: "webhook-update",
            url: "http://www.example.com",
            events: ["token:created"],
        });
        expect(response).toEqual({
            id: "7a70e388-9c78-4c1b-85dd-f2b4e7a823f6",
            tenantId: "064bbc70-204b-4ef1-a757-ec0878be5945",
            status: "enabled",
            name: "E2E delivery test - 2024-07-19T14:40:01.229Z",
            url: "https://example.basistheory.com/",
            notifyEmail: "notify@example.com",
            events: ["token.created"],
            createdBy: "b6b44a65-c13a-4df2-bd7f-894f4fbe6b02",
            createdAt: new Date("2024-07-18T20:20:18.000Z"),
            modifiedBy: "b6b44a65-c13a-4df2-bd7f-894f4fbe6b02",
            modifiedAt: new Date("2024-07-19T14:40:01.000Z"),
        });
    });

    test("delete", async () => {
        const server = mockServerPool.createServer();
        const client = new BasisTheoryClient({ apiKey: "test", correlationId: "test", environment: server.baseUrl });

        server.mockEndpoint().delete("/webhooks/id").respondWith().statusCode(200).build();

        const response = await client.webhooks.delete("id");
        expect(response).toEqual(undefined);
    });

    test("list", async () => {
        const server = mockServerPool.createServer();
        const client = new BasisTheoryClient({ apiKey: "test", correlationId: "test", environment: server.baseUrl });

        const rawResponseBody = {
            pagination: { page_size: 1, next: "AgAAAA==" },
            data: [
                {
                    id: "7a70e388-9c78-4c1b-85dd-f2b4e7a823f6",
                    tenant_id: "064bbc70-204b-4ef1-a757-ec0878be5945",
                    status: "enabled",
                    name: "E2E delivery test - 2024-07-19T14:40:01.229Z",
                    url: "https://example.basistheory.com/",
                    notify_email: "notify@example.com",
                    events: ["token.created"],
                    created_by: "b6b44a65-c13a-4df2-bd7f-894f4fbe6b02",
                    created_at: "2024-07-18T20:20:18Z",
                    modified_by: "b6b44a65-c13a-4df2-bd7f-894f4fbe6b02",
                    modified_at: "2024-07-19T14:40:01Z",
                },
            ],
        };
        server.mockEndpoint().get("/webhooks").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.webhooks.list();
        expect(response).toEqual({
            pagination: {
                pageSize: 1,
                next: "AgAAAA==",
            },
            data: [
                {
                    id: "7a70e388-9c78-4c1b-85dd-f2b4e7a823f6",
                    tenantId: "064bbc70-204b-4ef1-a757-ec0878be5945",
                    status: "enabled",
                    name: "E2E delivery test - 2024-07-19T14:40:01.229Z",
                    url: "https://example.basistheory.com/",
                    notifyEmail: "notify@example.com",
                    events: ["token.created"],
                    createdBy: "b6b44a65-c13a-4df2-bd7f-894f4fbe6b02",
                    createdAt: new Date("2024-07-18T20:20:18.000Z"),
                    modifiedBy: "b6b44a65-c13a-4df2-bd7f-894f4fbe6b02",
                    modifiedAt: new Date("2024-07-19T14:40:01.000Z"),
                },
            ],
        });
    });

    test("create", async () => {
        const server = mockServerPool.createServer();
        const client = new BasisTheoryClient({ apiKey: "test", correlationId: "test", environment: server.baseUrl });
        const rawRequestBody = { name: "webhook-create", url: "http://www.example.com", events: ["token:created"] };
        const rawResponseBody = {
            id: "7a70e388-9c78-4c1b-85dd-f2b4e7a823f6",
            tenant_id: "064bbc70-204b-4ef1-a757-ec0878be5945",
            status: "enabled",
            name: "E2E delivery test - 2024-07-19T14:40:01.229Z",
            url: "https://example.basistheory.com/",
            notify_email: "notify@example.com",
            events: ["token.created"],
            created_by: "b6b44a65-c13a-4df2-bd7f-894f4fbe6b02",
            created_at: "2024-07-18T20:20:18Z",
            modified_by: "b6b44a65-c13a-4df2-bd7f-894f4fbe6b02",
            modified_at: "2024-07-19T14:40:01Z",
        };
        server
            .mockEndpoint()
            .post("/webhooks")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.webhooks.create({
            name: "webhook-create",
            url: "http://www.example.com",
            events: ["token:created"],
        });
        expect(response).toEqual({
            id: "7a70e388-9c78-4c1b-85dd-f2b4e7a823f6",
            tenantId: "064bbc70-204b-4ef1-a757-ec0878be5945",
            status: "enabled",
            name: "E2E delivery test - 2024-07-19T14:40:01.229Z",
            url: "https://example.basistheory.com/",
            notifyEmail: "notify@example.com",
            events: ["token.created"],
            createdBy: "b6b44a65-c13a-4df2-bd7f-894f4fbe6b02",
            createdAt: new Date("2024-07-18T20:20:18.000Z"),
            modifiedBy: "b6b44a65-c13a-4df2-bd7f-894f4fbe6b02",
            modifiedAt: new Date("2024-07-19T14:40:01.000Z"),
        });
    });
});
